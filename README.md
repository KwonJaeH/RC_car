# RC_car
 Make auto


초음파 센서를 이용한 장애물 회피 기반, 
두가지 기능 구현 예정.

  
[1] 시작하고 일정 시간 지난 뒤, 다시 원래 시작 점으로 return.  
[2] 속도가 빠를 때, 갑자기 튀어나온 장애물에 대한 정지가 아닌 회피.    
          +      
발생한 문제 및 해결 방법

----------------------------------------

### [1] 시작하고 일정 시간 지난 뒤, 다시 원래 시작 점으로 return.
  
  > **가정**      
  >        1) 차는 좌,우 회전 시 '직각'으로만 회전한다.    
  >        2) 돌아오는 길에는 장애물이 없다.  
  >        3) "후진"은 하지않는다.    
  >        4) return 전 도착 지점이 x 또는 y가 0 인 경우는 고려하지 않는다.   
  >
  > * 2), 3), 4) 가정의 경우, 추가할 수 있으나 현재 구성을 단순히 작동하기 위함.   
  >
  > 시작점을 (0,0)으로 두고 1 ~ 4사분면에서 x, y 의 증감 상태를 기반으로 차의 진행 방향 파악.   
  > 차의 진행 방향 및 위치 파악 후, 시작점에 대한 회전 각도 계산.   
  > 회전 후, (0,0) 방향으로 직진 및 도착 시 정지.   
  >
  > **graph example**       
  > <img src="https://user-images.githubusercontent.com/81853056/148670117-3f5e3f85-546f-4467-bb3a-b61e19a60013.png" width="50%" height="50%" title="graph" alt="graph_ex"></img></br>
  > 빨간 곡선만큼 회전 후, 초록색 선을 따라 (0,0) 향해 직진.   
       
       

### [2] 속도가 빠를 때, 갑자기 튀어나온 장애물에 대한 정지가 아닌 회피.
  > **가정**    
  >        1) 갑자기 튀어나온 장애물은 폭이 작다. (ex. 현재 장애물 - 손)   
  >        
  > 속도가 최대이고, 장애물과의 거리가 가까울 때(20cm로 설정)    
  > 좌, 우 공간을 측정해 더 넓은 곳으로 이동.   
  >  
  > **example**   
  > <img src="https://user-images.githubusercontent.com/81853056/148670412-15df2f82-7420-419d-b1fc-146e264be4c5.png" width="30%" height="30%" title="move" alt="move_ex"></img></br>
  > 앞에 장애물이 갑자기 나왔을 때,   
  > 좌, 우 공간 확인 후, 더 넓은 공간으로 (example에서는 왼쪽) 좌회전 - 직진 - 우회전으로 장애물 회피 
----------------------------------------

### 발생한 문제 및 해결 방법
  * _**블루투스 HC-06 연결 문제**_    
   #### 블루투스 연결 실패 → 블루투스 명령 대신 '일정 시간'으로 대체   
   HC-06 블루투스와 Serial monitor와의 통신이 되지않아 블루투스만으로 3~4일을 애먹었다.    
   핀을 바꿔도 보고, 코드도 바꾸어 보고 해봤지만 해결이 되지 않아 새로운 블루투스를 구입하였다.    
   새로 산 블루투스도 되지 않았다. 구글링 해보니 HC-06에 불량인 경우가 많았다.  
   결과적으로 기능 [1]을 수행하기 위해 출발 및 정지 명령을 위한 블루투스이니  
   명령 대신에 '일정 시간'으로 대체하였다.   
   </br>
  * _**전류 문제**_ 
   ####  1.5V AA 알카라인 건전지 x 6개  →  리튬이온 3.7V 2600mAh x 3개  
  차체 정지 or 회전 후 다시 출발 등 모든 동작에 있어 중간에 자꾸 바퀴가 멈추는 현상이 발생했다.  
  차체를 다시 들고 바퀴를 굴리면 다시 가다가 멈추고를 반복했다.  
  1개의 모터드라이버에 4개의 DC모터를 사용해 전류, 전압 문제라 생각했다.        
  1) 모터 2개만 이용해 전륜, 후륜 방식을 생각    
      →  모터의 힘이 다른 움직이지 않는 바퀴의 마찰력을 이기지 못해 전진하지 않고 바퀴만 제자리서 헛도는 현상 발생

  2) V = IR 이라는 어릴 때 배운 기억으로 현 상황에 맞는 공식은 아니라고 생각되지만 적용하였다.    
  식만 보면 단순히 전압이 높으면 전류가 높아질 거란 생각으로    
  모터 드라이버의 허용 전류, 전압 내에 해당하는 기존보다 좀 더 높은 전압의 배터리로 교체하였다.  
  모터의 멈춤 현상은 더 일어나지 않았다.     
   </br>
       
  * _**회전 각 문제 (미해결)**_     <br>
     
  모터의 회전 각을 delay로 해결하려니 90도 도는데 delay(255)가 들고, 360도 도는데 delay(800) 정도가 들었다.   
  정확한 각도를 구하기 어려웠다. 그리고 똑같은 delay를 줘도 바닥의 마찰력 차이에 따라 도는 각도가 달랐다.     
  그래서 바퀴의 회전 수를 구할 수 있다면, 바퀴가 몇 바퀴 돌면 몇 도 도는지 일정하게 회전할 수 있을 거라 생각했다.   
  그리고 회전 수를 알고 있고 바퀴의 둘레만 안다면 이동 거리도 측정해 기능[1]을 더욱 설득력있게(?) 수행할 수 있을 거라 생각했다.  
  그렇게 바퀴 회전 수를 측정할 수 있는 인코더 HC-020K를 구매하였다.
  <br>
   <img src="https://user-images.githubusercontent.com/81853056/149904068-b5307647-0b6c-4d85-9a16-cd34da081289.jpg" width="30%" height="30%" title="move" alt="move_ex"></img></br>   
   
  **빨간색 동그라미**  는 저 축에 인코더의 디스크를 꽂는 곳이다. 그럼 IR 송수신기가 디스크를 사이에 두고 위치한다.    
  디스크의 크기가 커서 차체 바닥 면을 녹여서 잘랐다. 그렇게 **초록생 동그라미**인 rc카 가슴 한편에 구멍이 생겼다..   
  
  그렇게 인코더를 테스트하던 중에 디스크가 꽂힌 상태로 모터가 잘 회전할까 라는 의문이 들어 차를 회전시켜보았다.       
  **보라색 동그라미** 부분이 자꾸 디스크와 부딪혀 해당 바퀴만 다른 바퀴에 비해 회전이 잘 안되는 문제가 발생했다.   
  보라색 동그라미 부분의 부품은 차체와 모터를 연결해주는 필수적인 부분이라 제거할 수가 없다.   
  
  
